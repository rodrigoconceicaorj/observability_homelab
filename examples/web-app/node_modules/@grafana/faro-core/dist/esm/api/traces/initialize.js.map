{"version":3,"file":"initialize.js","sourceRoot":"","sources":["../../../../src/api/traces/initialize.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,iBAAiB,EAAE,MAAM,kBAAkB,CAAC;AAMrD,MAAM,UAAU,mBAAmB,CACjC,iBAAmC,EACnC,cAA8B,EAC9B,OAAe,EACf,KAAY,EACZ,UAAsB;IAEtB,cAAc,CAAC,KAAK,CAAC,yBAAyB,CAAC,CAAC;IAEhD,IAAI,IAAI,GAAwB,SAAS,CAAC;IAE1C,MAAM,QAAQ,GAA0B,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE;QACzD,cAAc,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC;QAEnD,IAAI,GAAG;YACL,KAAK;YACL,OAAO;SACR,CAAC;IACJ,CAAC,CAAC;IAEF,MAAM,eAAe,GAAiC,GAAG,EAAE;QACzD,MAAM,GAAG,GAAG,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC;QAE9D,OAAO,CAAC,GAAG;YACT,CAAC,CAAC,SAAS;YACX,CAAC,CAAC;gBACE,QAAQ,EAAE,GAAG,CAAC,OAAO;gBACrB,OAAO,EAAE,GAAG,CAAC,MAAM;aACpB,CAAC;IACR,CAAC,CAAC;IAEF,MAAM,UAAU,GAA4B,CAAC,OAAO,EAAE,EAAE;QACtD,IAAI,CAAC;YACH,MAAM,IAAI,GAA8B;gBACtC,IAAI,EAAE,iBAAiB,CAAC,KAAK;gBAC7B,OAAO;gBACP,IAAI,EAAE,KAAK,CAAC,KAAK;aAClB,CAAC;YAEF,cAAc,CAAC,KAAK,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC;YAE9C,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAC3B,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,cAAc,CAAC,KAAK,CAAC,uBAAuB,EAAE,GAAG,CAAC,CAAC;QACrD,CAAC;IACH,CAAC,CAAC;IAEF,MAAM,OAAO,GAAyB,GAAG,EAAE,CAAC,IAAI,CAAC;IAEjD,MAAM,iBAAiB,GAAmC,GAAG,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;IAEvE,OAAO;QACL,OAAO;QACP,eAAe;QACf,QAAQ;QACR,iBAAiB;QACjB,UAAU;KACX,CAAC;AACJ,CAAC","sourcesContent":["import type { Config } from '../../config';\nimport type { InternalLogger } from '../../internalLogger';\nimport type { Metas } from '../../metas';\nimport { TransportItemType } from '../../transports';\nimport type { TransportItem, Transports } from '../../transports/types';\nimport type { UnpatchedConsole } from '../../unpatchedConsole';\n\nimport type { OTELApi, TraceEvent, TracesAPI } from './types';\n\nexport function initializeTracesAPI(\n  _unpatchedConsole: UnpatchedConsole,\n  internalLogger: InternalLogger,\n  _config: Config,\n  metas: Metas,\n  transports: Transports\n): TracesAPI {\n  internalLogger.debug('Initializing traces API');\n\n  let otel: OTELApi | undefined = undefined;\n\n  const initOTEL: TracesAPI['initOTEL'] = (trace, context) => {\n    internalLogger.debug('Initializing OpenTelemetry');\n\n    otel = {\n      trace,\n      context,\n    };\n  };\n\n  const getTraceContext: TracesAPI['getTraceContext'] = () => {\n    const ctx = otel?.trace.getSpanContext(otel.context.active());\n\n    return !ctx\n      ? undefined\n      : {\n          trace_id: ctx.traceId,\n          span_id: ctx.spanId,\n        };\n  };\n\n  const pushTraces: TracesAPI['pushTraces'] = (payload) => {\n    try {\n      const item: TransportItem<TraceEvent> = {\n        type: TransportItemType.TRACE,\n        payload,\n        meta: metas.value,\n      };\n\n      internalLogger.debug('Pushing trace\\n', item);\n\n      transports.execute(item);\n    } catch (err) {\n      internalLogger.error('Error pushing trace\\n', err);\n    }\n  };\n\n  const getOTEL: TracesAPI['getOTEL'] = () => otel;\n\n  const isOTELInitialized: TracesAPI['isOTELInitialized'] = () => !!otel;\n\n  return {\n    getOTEL,\n    getTraceContext,\n    initOTEL,\n    isOTELInitialized,\n    pushTraces,\n  };\n}\n"]}