{"version":3,"file":"initialize.test.js","sourceRoot":"","sources":["../../../../../../src/api/exceptions/initialize.test.ts"],"names":[],"mappings":";;AAAA,+CAAkD;AAClD,6CAAgF;AAChF,+CAAoE;AACpE,qCAAsC;AACtC,oDAA6E;AAC7E,kCAAkF;AAClF,4CAA2C;AAG3C,2CAAuD;AAGvD,QAAQ,CAAC,gBAAgB,EAAE;IACzB,SAAS,SAAS,CAAC,EAAkD;YAAlD,qBAAkC,EAAE,MAAM,EAAE,IAAI,EAAE,KAAA,EAAhD,MAAM,YAAA;QACzB,IAAM,SAAS,GAAG,IAAI,yBAAa,EAAE,CAAC;QACtC,IAAM,MAAM,GAAG,IAAA,sBAAU,EAAC;YACxB,MAAM,QAAA;YACN,UAAU,EAAE,CAAC,SAAS,CAAC;SACxB,CAAC,CAAC;QAEK,IAAA,GAAG,GAAK,IAAA,2BAAc,EAAC,MAAM,CAAC,IAA3B,CAA4B;QAEvC,OAAO,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;IAC1B,CAAC;IAED,QAAQ,CAAC,WAAW,EAAE;QACpB,IAAI,GAAQ,CAAC;QACb,IAAI,SAAwB,CAAC;QAE7B,UAAU,CAAC;;YACT,KAAmB,SAAS,EAAE,EAA7B,GAAG,QAAA,EAAE,SAAS,QAAA,CAAgB;QACjC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sBAAsB,EAAE;YACzB,IAAM,MAAM,GAA0B;gBACpC;oBACE,QAAQ,EAAE,QAAQ;oBAClB,QAAQ,EAAE,OAAO;oBACjB,KAAK,EAAE,CAAC;oBACR,MAAM,EAAE,EAAE;iBACX;gBACD;oBACE,QAAQ,EAAE,QAAQ;oBAClB,QAAQ,EAAE,OAAO;oBACjB,KAAK,EAAE,CAAC;oBACR,MAAM,EAAE,EAAE;iBACX;aACF,CAAC;YAEF,IAAM,iBAAiB,GAAG;gBACxB,OAAO,EAAE,sBAAsB;gBAC/B,mBAAmB,EAAE,qBAAqB;aAC3C,CAAC;YAEF,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,gBAAgB,CAAC,EAAE;gBACzC,WAAW,EAAE,MAAM;gBACnB,IAAI,EAAE,WAAW;gBACjB,OAAO,EAAE,iBAAiB;aAC3B,CAAC,CAAC;YAEH,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAExC,IAAM,OAAO,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACnC,MAAM,CAAC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,OAAO,CAAC,CAAC,UAAU,EAAE,CAAC;YACtC,MAAM,CAAC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,IAAI,CAAC,CAAC,OAAO,CAAC,8BAAiB,CAAC,SAAS,CAAC,CAAC;YAE3D,IAAM,GAAG,GAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,OAAyB,CAAC;YAC/C,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;YACtC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;YAC5C,MAAM,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,EAAE,MAAM,QAAA,EAAE,CAAC,CAAC;YAC3C,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;QACjD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yBAAyB,EAAE;;YAC5B,IAAM,GAAG,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;YAC9B,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;YACnB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAExC,IAAM,OAAO,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACnC,MAAM,CAAC,MAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,IAAI,CAAC,GAAG,0CAAE,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAChD,MAAM,CAAC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,OAAO,CAAC,CAAC,UAAU,EAAE,CAAC;YACtC,MAAM,CAAC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,IAAI,CAAC,CAAC,OAAO,CAAC,8BAAiB,CAAC,SAAS,CAAC,CAAC;YAE3D,IAAM,GAAG,GAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,OAAyB,CAAC;YAC/C,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YAClC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAClC,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,UAAU,EAAE,CAAC;YAEnC,IAAM,UAAU,GAAG,GAAG,CAAC,UAAU,CAAC;YAClC,MAAM,CAAC,UAAU,CAAC,CAAC,UAAU,EAAE,CAAC;YAChC,MAAM,CAAC,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,MAAM,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YACrD,MAAM,CAAC,MAAA,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,MAAM,CAAC,CAAC,CAAC,0CAAE,QAAQ,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QACjE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,kCAAkC,EAAE;YACrC,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;YACjC,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,EAAE;gBAChC,OAAO,EAAE,EAAE;aACZ,CAAC,CAAC;YACH,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACxC,MAAM,CAAE,SAAS,CAAC,KAAK,CAAC,CAAC,CAAmC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAAa,EAAE,CAAC;YAC9F,MAAM,CAAE,SAAS,CAAC,KAAK,CAAC,CAAC,CAAmC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAAa,EAAE,CAAC;QAChG,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,uCAAuC,EAAE;;YAC1C,IAAM,SAAS,GAAG,IAAI,yBAAa,EAAE,CAAC;YACtC,IAAM,MAAM,GAAG,IAAA,sBAAU,EAAC;gBACxB,UAAU,EAAE,CAAC,SAAS,CAAC;gBACvB,qBAAqB,EAAE,IAAI;aAC5B,CAAC,CAAC;YAEK,IAAA,GAAG,GAAK,IAAA,2BAAc,EAAC,MAAM,CAAC,IAA3B,CAA4B;YAEvC,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;YAChC,GAAG,CAAC,SAAS,CAAC,KAAK,EAAE,EAAE,aAAa,EAAE,KAAK,EAAE,CAAC,CAAC;YAE/C,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACxC,MAAM,CAAC,CAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAAkC,CAAA,CAAC,aAAa,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAC/F,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,WAAW,EAAE;YACpB,EAAE,CAAC,wBAAwB,EAAE;gBAC3B,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEhC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,kEAAkE,EAAE;gBACrE,IAAM,MAAM,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBACjC,IAAM,MAAM,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEjC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBACtB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBACtB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,8DAA8D,EAAE;gBACjE,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEhC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;gBACxB,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,gFAAgF,EAAE;gBACnF,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEhC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,KAAK,CAAC,IAAI,GAAG,cAAc,CAAC;gBAC5B,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,4DAA4D,EAAE;gBAC/D,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEhC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,KAAK,CAAC,IAAI,GAAG,cAAc,CAAC;gBAC5B,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,qCAAqC,EAAE;;gBACxC,KAAmB,SAAS,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAA9C,GAAG,QAAA,EAAE,SAAS,QAAA,CAAiC;gBAEhD,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEhC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,wCAAwC,EAAE;gBAC3C,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEhC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,GAAG,CAAC,SAAS,CAAC,KAAK,EAAE;oBACnB,UAAU,EAAE,IAAI;iBACjB,CAAC,CAAC;gBACH,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,2FAA2F,EAAE;gBAC9F,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEhC,GAAG,CAAC,SAAS,CAAC,KAAK,EAAE,EAAE,OAAO,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;gBAClD,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,GAAG,CAAC,SAAS,CAAC,KAAK,EAAE,EAAE,OAAO,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;gBAClD,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,6CAA6C,EAAE;;gBAChD,IAAM,WAAW,GAAoC;oBACnD,OAAO,EAAE,aAAa;oBACtB,MAAM,EAAE,YAAY;iBACrB,CAAC;gBAEF,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEhC,GAAG,CAAC,SAAS,CAAC,KAAK,EAAE,EAAE,WAAW,aAAA,EAAE,CAAC,CAAC;gBACtC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBACxC,MAAM,CAAC,CAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,CAAA,CAAC,KAAK,CAAC,CAAC,aAAa,CAAC;oBAC1E,QAAQ,EAAE,aAAa;oBACvB,OAAO,EAAE,YAAY;iBACtB,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,qDAAqD,EAAE;;gBACxD,GAAG,CAAC,SAAS,CAAC,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,EAAE,oBAAoB,EAAE,GAAG,EAAE,CAAC,CAAC;gBAC3E,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBACxC,MAAM,CAAC,CAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,CAAA,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;YACrG,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,mCAAmC,EAAE;;gBACtC,qDAAqD;gBACrD,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;gBAClD,qDAAqD;gBACrD,IAAM,MAAM,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;gBACrD,qDAAqD;gBACrD,IAAM,MAAM,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;gBACzD,qDAAqD;gBACrD,IAAM,MAAM,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,EAAE,KAAK,EAAE,IAAI,KAAK,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAC;gBAC1E,qDAAqD;gBACrD,IAAM,MAAM,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;gBACnD,qDAAqD;gBACrD,IAAM,MAAM,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC;gBACxD,IAAM,MAAM,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;gBAElC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;gBACrB,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBACtB,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBACtB,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBACtB,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBACtB,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBACtB,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBAEtB,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBAExC,MAAM,CAAC,MAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,0CAAE,OAAO,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;gBAC3F,MAAM,CAAC,MAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,0CAAE,OAAO,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC;gBAC7F,MAAM,CAAC,MAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,0CAAE,OAAO,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC,CAAC;gBACjG,MAAM,CAAC,MAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,0CAAE,OAAO,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,uBAAuB,EAAE,CAAC,CAAC;gBAC7G,MAAM,CAAC,MAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,0CAAE,OAAO,CAAC,CAAC,aAAa,EAAE,CAAC;gBACjF,MAAM,CAAC,MAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,0CAAE,OAAO,CAAC,CAAC,aAAa,EAAE,CAAC;gBACjF,MAAM,CAAC,MAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,0CAAE,OAAO,CAAC,CAAC,aAAa,EAAE,CAAC;YACnF,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,6CAA6C,EAAE;;gBAChD,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,oBAAoB,CAAC,EAAE;oBAC7C,OAAO,EAAE;wBACP,mBAAmB;wBACnB,CAAC,EAAE,CAAC;wBACJ,CAAC,EAAE,KAAK;wBACR,mBAAmB;wBACnB,CAAC,EAAE,IAAI;wBACP,mBAAmB;wBACnB,CAAC,EAAE,EAAE,CAAC,EAAE,KAAK,EAAE;wBACf,mBAAmB;wBACnB,CAAC,EAAE,IAAI;wBACP,mBAAmB;wBACnB,CAAC,EAAE,SAAS;wBACZ,mBAAmB;wBACnB,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;qBACb;iBACF,CAAC,CAAC;gBAEH,IAAM,OAAO,GAAG,MAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,0CAAE,OAAO,CAAC;gBACzE,MAAM,CAAC,OAAO,CAAC,CAAC,aAAa,CAAC;oBAC5B,CAAC,EAAE,GAAG;oBACN,CAAC,EAAE,KAAK;oBACR,CAAC,EAAE,MAAM;oBACT,CAAC,EAAE,aAAa;oBAChB,CAAC,EAAE,MAAM;oBACT,CAAC,EAAE,WAAW;oBACd,CAAC,EAAE,SAAS;iBACb,CAAC,CAAC;gBAEH,MAAM,CAAC,MAAM,CAAC,OAAO,aAAP,OAAO,cAAP,OAAO,GAAI,EAAE,CAAC,CAAC,OAAO,CAAC,UAAC,KAAK;oBACzC,MAAM,CAAC,OAAO,KAAK,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBACtC,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,qBAAqB,EAAE;YAC9B,EAAE,CAAC,2CAA2C,EAAE;;gBAC9C,IAAM,SAAS,GAAG,IAAI,yBAAa,EAAE,CAAC;gBAE9B,IAAA,GAAG,GAAK,IAAA,2BAAc,EAC5B,IAAA,sBAAU,EAAC;oBACT,UAAU,EAAE,CAAC,SAAS,CAAC;oBACvB,YAAY,EAAE,CAAC,uBAAuB,EAAE,yBAAyB,EAAE,sCAAsC,CAAC;iBAC3G,CAAC,CACH,IALU,CAKT;gBAEF,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,2CAA2C,CAAC,CAAC,CAAC;gBACtE,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,mFAAmF,CAAC,CAAC,CAAC;gBAC9G,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,+EAA+E,CAAC,CAAC,CAAC;gBAE1G,IAAM,YAAY,GAAG,+BAA+B,CAAC;gBACrD,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC;gBAEvC,IAAM,uBAAuB,GAAG,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC;gBACpE,uBAAuB,CAAC,IAAI,GAAG,WAAW,CAAC;gBAC3C,uBAAuB,CAAC,KAAK,GAAG,uRAG2C,CAAC;gBAC5E,GAAG,CAAC,SAAS,CAAC,uBAAuB,CAAC,CAAC;gBAEvC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBACxC,MAAM,CAAC,CAAC,MAAA,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,0CAAE,OAA0B,CAAA,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YACtF,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,aAAa,EAAE;YACtB,EAAE,CAAC,mDAAmD,EAAE;gBACtD,IAAM,cAAc,GAAG,8BAAkB,CAAC;gBAC1C,IAAM,MAAM,GAAG,IAAA,sBAAU,GAAE,CAAC;gBAE5B,IAAM,YAAY,GAAG,IAAI,uBAAU,EAA2B,CAAC;gBAE/D,IAAI,OAA0C,CAAC;gBAE/C,IAAM,UAAU,GAAG,cAAM,OAAA,OAAO,EAAP,CAAO,CAAC;gBAEjC,OAAO,GAAG;oBACR,IAAI,EAAE,yBAAiB;oBACvB,IAAI,EAAE,YAAY;oBAClB,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;oBACrB,QAAQ,EAAE,WAAW;iBACtB,CAAC;gBACF,IAAM,GAAG,GAAG,IAAA,oCAAuB,EAAC;oBAClC,gBAAgB,EAAE,OAAO;oBACzB,cAAc,gBAAA;oBACd,MAAM,QAAA;oBACN,KAAK,EAAE,0BAAS;oBAChB,UAAU,EAAE,+BAAc;oBAC1B,SAAS,EAAE,8BAAa;oBACxB,YAAY,cAAA;oBACZ,UAAU,YAAA;iBACX,CAAC,CAAC;gBAEH,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC;gBACvC,MAAM,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBAEpC,OAAO,GAAG;oBACR,IAAI,EAAE,uBAAe;oBACrB,IAAI,EAAE,YAAY;oBAClB,EAAE,EAAE,WAAW;oBACf,SAAS,EAAE,IAAA,eAAO,GAAE;oBACpB,OAAO,EAAE,IAAA,eAAO,GAAE;oBAClB,QAAQ,EAAE,CAAC;oBACX,SAAS,EAAE,OAAO;iBACnB,CAAC;gBAEF,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC;gBACzC,MAAM,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBAEpC,OAAO,GAAG;oBACR,IAAI,EAAE,0BAAkB;oBACxB,IAAI,EAAE,YAAY;oBAClB,QAAQ,EAAE,WAAW;iBACtB,CAAC;gBAEF,GAAG,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC;gBACzC,MAAM,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACtC,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import { initializeFaro } from '../../initialize';\nimport { mockConfig, mockInternalLogger, MockTransport } from '../../testUtils';\nimport { TransportItem, TransportItemType } from '../../transports';\nimport { dateNow } from '../../utils';\nimport { mockMetas, mockTracesApi, mockTransports } from '../apiTestHelpers';\nimport { USER_ACTION_CANCEL, USER_ACTION_END, USER_ACTION_START } from '../const';\nimport { ItemBuffer } from '../ItemBuffer';\nimport type { API, APIEvent, ApiMessageBusMessages } from '../types';\n\nimport { initializeExceptionsAPI } from './initialize';\nimport type { ExceptionEvent, ExceptionEventExtended, ExceptionStackFrame, PushErrorOptions } from './types';\n\ndescribe('api.exceptions', () => {\n  function createAPI({ dedupe }: { dedupe: boolean } = { dedupe: true }): [API, MockTransport] {\n    const transport = new MockTransport();\n    const config = mockConfig({\n      dedupe,\n      transports: [transport],\n    });\n\n    const { api } = initializeFaro(config);\n\n    return [api, transport];\n  }\n\n  describe('pushError', () => {\n    let api: API;\n    let transport: MockTransport;\n\n    beforeEach(() => {\n      [api, transport] = createAPI();\n    });\n\n    it('error with overrides', () => {\n      const frames: ExceptionStackFrame[] = [\n        {\n          filename: 'foo.js',\n          function: 'FooFn',\n          colno: 4,\n          lineno: 23,\n        },\n        {\n          filename: 'bar.js',\n          function: 'BarFn',\n          colno: 6,\n          lineno: 52,\n        },\n      ];\n\n      const additionalContext = {\n        message: 'React error boundary',\n        componentStackTrace: 'componentStackTrace',\n      };\n\n      api.pushError(new Error('test exception'), {\n        stackFrames: frames,\n        type: 'TestError',\n        context: additionalContext,\n      });\n\n      expect(transport.items).toHaveLength(1);\n\n      const payload = transport.items[0];\n      expect(payload?.payload).toBeTruthy();\n      expect(payload?.type).toEqual(TransportItemType.EXCEPTION);\n\n      const evt = payload?.payload as ExceptionEvent;\n      expect(evt.type).toEqual('TestError');\n      expect(evt.value).toEqual('test exception');\n      expect(evt.stacktrace).toEqual({ frames });\n      expect(evt.context).toEqual(additionalContext);\n    });\n\n    it('error without overrides', () => {\n      const err = new Error('test');\n      api.pushError(err);\n      expect(transport.items).toHaveLength(1);\n\n      const payload = transport.items[0];\n      expect(payload?.meta.app?.name).toEqual('test');\n      expect(payload?.payload).toBeTruthy();\n      expect(payload?.type).toEqual(TransportItemType.EXCEPTION);\n\n      const evt = payload?.payload as ExceptionEvent;\n      expect(evt.type).toEqual('Error');\n      expect(evt.value).toEqual('test');\n      expect(evt.timestamp).toBeTruthy();\n\n      const stacktrace = evt.stacktrace;\n      expect(stacktrace).toBeTruthy();\n      expect(stacktrace?.frames.length).toBeGreaterThan(3);\n      expect(stacktrace?.frames[0]?.filename).toEqual('Error: test');\n    });\n\n    it('does not stringify empty context', () => {\n      api.pushError(new Error('test'));\n      api.pushError(new Error('test2'), {\n        context: {},\n      });\n      expect(transport.items).toHaveLength(2);\n      expect((transport.items[0] as TransportItem<ExceptionEvent>).payload.context).toBeUndefined();\n      expect((transport.items[0] as TransportItem<ExceptionEvent>).payload.context).toBeUndefined();\n    });\n\n    it('add the original error to the payload', () => {\n      const transport = new MockTransport();\n      const config = mockConfig({\n        transports: [transport],\n        preserveOriginalError: true,\n      });\n\n      const { api } = initializeFaro(config);\n\n      const error = new Error('test');\n      api.pushError(error, { originalError: error });\n\n      expect(transport.items).toHaveLength(1);\n      expect((transport.items[0]?.payload as ExceptionEventExtended).originalError).toEqual(error);\n    });\n\n    describe('Filtering', () => {\n      it('filters the same event', () => {\n        const error = new Error('test');\n\n        api.pushError(error);\n        expect(transport.items).toHaveLength(1);\n\n        api.pushError(error);\n        expect(transport.items).toHaveLength(1);\n      });\n\n      it(\"doesn't filter events with same message and different stacktrace\", () => {\n        const error1 = new Error('test');\n        const error2 = new Error('test');\n\n        api.pushError(error1);\n        expect(transport.items).toHaveLength(1);\n\n        api.pushError(error2);\n        expect(transport.items).toHaveLength(2);\n      });\n\n      it(\"doesn't filter events with other message and same stacktrace\", () => {\n        const error = new Error('test');\n\n        api.pushError(error);\n        expect(transport.items).toHaveLength(1);\n\n        error.message = 'test2';\n        api.pushError(error);\n        expect(transport.items).toHaveLength(2);\n      });\n\n      it(\"doesn't filter events with same message and same stacktrace but different type\", () => {\n        const error = new Error('test');\n\n        api.pushError(error);\n        expect(transport.items).toHaveLength(1);\n\n        error.name = 'Another Type';\n        api.pushError(error);\n        expect(transport.items).toHaveLength(2);\n      });\n\n      it(\"filters an event and doesn't filter the next different one\", () => {\n        const error = new Error('test');\n\n        api.pushError(error);\n        expect(transport.items).toHaveLength(1);\n\n        api.pushError(error);\n        expect(transport.items).toHaveLength(1);\n\n        error.name = 'Another Type';\n        api.pushError(error);\n        expect(transport.items).toHaveLength(2);\n      });\n\n      it(\"doesn't filter when dedupe is false\", () => {\n        [api, transport] = createAPI({ dedupe: false });\n\n        const error = new Error('test');\n\n        api.pushError(error);\n        expect(transport.items).toHaveLength(1);\n\n        api.pushError(error);\n        expect(transport.items).toHaveLength(2);\n      });\n\n      it(\"doesn't filter when skipDedupe is true\", () => {\n        const error = new Error('test');\n\n        api.pushError(error);\n        expect(transport.items).toHaveLength(1);\n\n        api.pushError(error, {\n          skipDedupe: true,\n        });\n        expect(transport.items).toHaveLength(2);\n      });\n\n      it(\"doesn't filter events with same message, same stacktrace, same type but different context\", () => {\n        const error = new Error('test');\n\n        api.pushError(error, { context: { foo: 'bar' } });\n        expect(transport.items).toHaveLength(1);\n\n        api.pushError(error, { context: { bar: 'baz' } });\n        expect(transport.items).toHaveLength(2);\n      });\n\n      it('uses traceId and spanId from custom context', () => {\n        const spanContext: PushErrorOptions['spanContext'] = {\n          traceId: 'my-trace-id',\n          spanId: 'my-span-id',\n        };\n\n        const error = new Error('test');\n\n        api.pushError(error, { spanContext });\n        expect(transport.items).toHaveLength(1);\n        expect((transport.items[0]?.payload as ExceptionEvent).trace).toStrictEqual({\n          trace_id: 'my-trace-id',\n          span_id: 'my-span-id',\n        });\n      });\n\n      it('Sets the timestamp to the provided custom timestamp', () => {\n        api.pushEvent('test', undefined, undefined, { timestampOverwriteMs: 123 });\n        expect(transport.items).toHaveLength(1);\n        expect((transport.items[0]?.payload as ExceptionEvent).timestamp).toBe('1970-01-01T00:00:00.123Z');\n      });\n\n      it('Adds error cause to error context', () => {\n        // @ts-expect-error cause is missing in TS type Error\n        const error = new Error('test', { cause: 'foo' });\n        // @ts-expect-error cause is missing in TS type Error\n        const error2 = new Error('test2', { cause: [1, 3] });\n        // @ts-expect-error cause is missing in TS type Error\n        const error3 = new Error('test3', { cause: { a: 'b' } });\n        // @ts-expect-error cause is missing in TS type Error\n        const error4 = new Error('test4', { cause: new Error('original error') });\n        // @ts-expect-error cause is missing in TS type Error\n        const error5 = new Error('test5', { cause: null });\n        // @ts-expect-error cause is missing in TS type Error\n        const error6 = new Error('test6', { cause: undefined });\n        const error7 = new Error('test6');\n\n        api.pushError(error);\n        api.pushError(error2);\n        api.pushError(error3);\n        api.pushError(error4);\n        api.pushError(error5);\n        api.pushError(error6);\n        api.pushError(error7);\n\n        expect(transport.items).toHaveLength(7);\n\n        expect((transport.items[0]?.payload as ExceptionEvent)?.context).toEqual({ cause: 'foo' });\n        expect((transport.items[1]?.payload as ExceptionEvent)?.context).toEqual({ cause: '[1,3]' });\n        expect((transport.items[2]?.payload as ExceptionEvent)?.context).toEqual({ cause: '{\"a\":\"b\"}' });\n        expect((transport.items[3]?.payload as ExceptionEvent)?.context).toEqual({ cause: 'Error: original error' });\n        expect((transport.items[4]?.payload as ExceptionEvent)?.context).toBeUndefined();\n        expect((transport.items[5]?.payload as ExceptionEvent)?.context).toBeUndefined();\n        expect((transport.items[6]?.payload as ExceptionEvent)?.context).toBeUndefined();\n      });\n\n      it('stringifies all values added to the context', () => {\n        api.pushError(new Error('Error with context'), {\n          context: {\n            // @ts-expect-error\n            a: 1,\n            b: 'foo',\n            // @ts-expect-error\n            c: true,\n            // @ts-expect-error\n            d: { e: 'bar' },\n            // @ts-expect-error\n            g: null,\n            // @ts-expect-error\n            h: undefined,\n            // @ts-expect-error\n            i: [1, 2, 3],\n          },\n        });\n\n        const context = (transport.items[0]?.payload as ExceptionEvent)?.context;\n        expect(context).toStrictEqual({\n          a: '1',\n          b: 'foo',\n          c: 'true',\n          d: '{\"e\":\"bar\"}',\n          g: 'null',\n          h: 'undefined',\n          i: '[1,2,3]',\n        });\n\n        Object.values(context ?? {}).forEach((value) => {\n          expect(typeof value).toBe('string');\n        });\n      });\n    });\n\n    describe('config.ignoreErrors', () => {\n      it('will filter out errors by string or regex', () => {\n        const transport = new MockTransport();\n\n        const { api } = initializeFaro(\n          mockConfig({\n            transports: [transport],\n            ignoreErrors: ['Error: ResizeObserver', /FetchError[:\\s\\w\\/]*pwc/, 'chrome-extension://mock-extension-id'],\n          })\n        );\n\n        api.pushError(new Error('Error: ResizeObserver loop limit exceeded'));\n        api.pushError(new Error('FetchError: 404 \\n  Instantiating https://pwc.grafana.net/public/react-router-dom'));\n        api.pushError(new Error('FetchError: 404 \\n  Instantiating https://pwc.grafana.net/public/@emotion/css'));\n\n        const typeErrorMsg = 'TypeError: _.viz is undefined';\n        api.pushError(new Error(typeErrorMsg));\n\n        const mockErrorWithStacktrace = new Error('Mock error for testing');\n        mockErrorWithStacktrace.name = 'MockError';\n        mockErrorWithStacktrace.stack = `MockError: Mock error for testing\n    at mockFunction (chrome-extension://mock-extension-id/mock-file.js:10:15)\n    at anotherFunction (chrome-extension://mock-extension-id/mock-file.js:20:5)\n    at Object.<anonymous> (chrome-extension://mock-extension-id/mock-file.js:30:3)`;\n        api.pushError(mockErrorWithStacktrace);\n\n        expect(transport.items).toHaveLength(1);\n        expect((transport.items[0]?.payload as ExceptionEvent).value).toEqual(typeErrorMsg);\n      });\n    });\n\n    describe('User action', () => {\n      it('buffers the error if a user action is in progress', () => {\n        const internalLogger = mockInternalLogger;\n        const config = mockConfig();\n\n        const actionBuffer = new ItemBuffer<TransportItem<APIEvent>>();\n\n        let message: ApiMessageBusMessages | undefined;\n\n        const getMessage = () => message;\n\n        message = {\n          type: USER_ACTION_START,\n          name: 'testAction',\n          startTime: Date.now(),\n          parentId: 'parent-id',\n        };\n        const api = initializeExceptionsAPI({\n          unpatchedConsole: console,\n          internalLogger,\n          config,\n          metas: mockMetas,\n          transports: mockTransports,\n          tracesApi: mockTracesApi,\n          actionBuffer,\n          getMessage,\n        });\n\n        api.pushError(new Error('test error'));\n        expect(actionBuffer.size()).toBe(1);\n\n        message = {\n          type: USER_ACTION_END,\n          name: 'testAction',\n          id: 'parent-id',\n          startTime: dateNow(),\n          endTime: dateNow(),\n          duration: 0,\n          eventType: 'click',\n        };\n\n        api.pushError(new Error('test error 2'));\n        expect(actionBuffer.size()).toBe(1);\n\n        message = {\n          type: USER_ACTION_CANCEL,\n          name: 'testAction',\n          parentId: 'parent-id',\n        };\n\n        api.pushError(new Error('test error 3'));\n        expect(actionBuffer.size()).toBe(1);\n      });\n    });\n  });\n});\n"]}