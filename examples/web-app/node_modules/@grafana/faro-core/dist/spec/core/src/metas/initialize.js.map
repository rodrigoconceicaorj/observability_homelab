{"version":3,"file":"initialize.js","sourceRoot":"","sources":["../../../../../src/metas/initialize.ts"],"names":[],"mappings":";;AAOA,0CAuDC;AA3DD,kCAAsC;AAItC,SAAgB,eAAe,CAC7B,iBAAmC,EACnC,cAA8B,EAC9B,OAAe;IAEf,IAAI,KAAK,GAAe,EAAE,CAAC;IAC3B,IAAI,SAAS,GAAoB,EAAE,CAAC;IAEpC,IAAM,QAAQ,GAAG,cAAM,OAAA,KAAK,CAAC,MAAM,CAAO,UAAC,GAAG,EAAE,IAAI,IAAK,OAAA,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,IAAA,kBAAU,EAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,EAApD,CAAoD,EAAE,EAAE,CAAC,EAA3F,CAA2F,CAAC;IAEnH,IAAM,eAAe,GAAG;QACtB,IAAI,SAAS,CAAC,MAAM,EAAE,CAAC;YACrB,IAAM,OAAK,GAAG,QAAQ,EAAE,CAAC;YAEzB,SAAS,CAAC,OAAO,CAAC,UAAC,QAAQ,IAAK,OAAA,QAAQ,CAAC,OAAK,CAAC,EAAf,CAAe,CAAC,CAAC;QACnD,CAAC;IACH,CAAC,CAAC;IAEF,IAAM,GAAG,GAAiB;QAAC,kBAAW;aAAX,UAAW,EAAX,qBAAW,EAAX,IAAW;YAAX,6BAAW;;QACpC,cAAc,CAAC,KAAK,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;QAEjD,KAAK,CAAC,IAAI,OAAV,KAAK,EAAS,QAAQ,EAAE;QAExB,eAAe,EAAE,CAAC;IACpB,CAAC,CAAC;IAEF,IAAM,MAAM,GAAoB;QAAC,uBAAgB;aAAhB,UAAgB,EAAhB,qBAAgB,EAAhB,IAAgB;YAAhB,kCAAgB;;QAC/C,cAAc,CAAC,KAAK,CAAC,kBAAkB,EAAE,aAAa,CAAC,CAAC;QAExD,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,UAAC,WAAW,IAAK,OAAA,CAAC,aAAa,CAAC,QAAQ,CAAC,WAAW,CAAC,EAApC,CAAoC,CAAC,CAAC;QAE5E,eAAe,EAAE,CAAC;IACpB,CAAC,CAAC;IAEF,IAAM,WAAW,GAAyB,UAAC,QAAQ;QACjD,cAAc,CAAC,KAAK,CAAC,yBAAyB,EAAE,QAAQ,CAAC,CAAC;QAE1D,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC3B,CAAC,CAAC;IAEF,IAAM,cAAc,GAA4B,UAAC,QAAQ;QACvD,cAAc,CAAC,KAAK,CAAC,2BAA2B,EAAE,QAAQ,CAAC,CAAC;QAE5D,SAAS,GAAG,SAAS,CAAC,MAAM,CAAC,UAAC,eAAe,IAAK,OAAA,eAAe,KAAK,QAAQ,EAA5B,CAA4B,CAAC,CAAC;IAClF,CAAC,CAAC;IAEF,OAAO;QACL,GAAG,KAAA;QACH,MAAM,QAAA;QACN,WAAW,aAAA;QACX,cAAc,gBAAA;QACd,IAAI,KAAK;YACP,OAAO,QAAQ,EAAE,CAAC;QACpB,CAAC;KACF,CAAC;AACJ,CAAC","sourcesContent":["import type { Config } from '../config';\nimport type { InternalLogger } from '../internalLogger';\nimport type { UnpatchedConsole } from '../unpatchedConsole';\nimport { isFunction } from '../utils';\n\nimport type { Meta, MetaItem, Metas, MetasListener } from './types';\n\nexport function initializeMetas(\n  _unpatchedConsole: UnpatchedConsole,\n  internalLogger: InternalLogger,\n  _config: Config\n): Metas {\n  let items: MetaItem[] = [];\n  let listeners: MetasListener[] = [];\n\n  const getValue = () => items.reduce<Meta>((acc, item) => Object.assign(acc, isFunction(item) ? item() : item), {});\n\n  const notifyListeners = () => {\n    if (listeners.length) {\n      const value = getValue();\n\n      listeners.forEach((listener) => listener(value));\n    }\n  };\n\n  const add: Metas['add'] = (...newItems) => {\n    internalLogger.debug('Adding metas\\n', newItems);\n\n    items.push(...newItems);\n\n    notifyListeners();\n  };\n\n  const remove: Metas['remove'] = (...itemsToRemove) => {\n    internalLogger.debug('Removing metas\\n', itemsToRemove);\n\n    items = items.filter((currentItem) => !itemsToRemove.includes(currentItem));\n\n    notifyListeners();\n  };\n\n  const addListener: Metas['addListener'] = (listener) => {\n    internalLogger.debug('Adding metas listener\\n', listener);\n\n    listeners.push(listener);\n  };\n\n  const removeListener: Metas['removeListener'] = (listener) => {\n    internalLogger.debug('Removing metas listener\\n', listener);\n\n    listeners = listeners.filter((currentListener) => currentListener !== listener);\n  };\n\n  return {\n    add,\n    remove,\n    addListener,\n    removeListener,\n    get value() {\n      return getValue();\n    },\n  };\n}\n"]}